"use strict";(self.webpackChunk_morgan_stanley_ComposeUI_gh_pages=self.webpackChunk_morgan_stanley_ComposeUI_gh_pages||[]).push([[337],{3390:function(e,t,n){n.r(t),n.d(t,{Head:function(){return m},default:function(){return h}});var a=n(8453),l=n(6540);function r(e){const t=Object.assign({h2:"h2",a:"a",span:"span",p:"p",ol:"ol",li:"li",h3:"h3",h4:"h4"},(0,a.RP)(),e.components);return l.createElement(l.Fragment,null,"\n",l.createElement(t.h2,{id:"context",style:{position:"relative"}},l.createElement(t.a,{href:"#context","aria-label":"context permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Context"),"\n",l.createElement(t.p,null,"For some features to work, we are preloading JavaScript code into web views (eg. Message Router configuration).\nThese scripts might add configuration or code that can grant access to protected APIs meant for trusted modules only.\nSince some web modules create iframes and windows using ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">window.open()</code>'}}),", we must specify what and when to load into these views."),"\n",l.createElement(t.p,null,"This ADR answers the following questions:"),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"When a web module creates a new web view, should that view inherit the identity of the module from the top-level window?"),"\n",l.createElement(t.li,null,"Should we preload scripts into dynamically created web views?"),"\n"),"\n",l.createElement(t.p,null,"Any solution must be consistent with web security principles such as the ",l.createElement(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy"},"Same Origin Policy"),",\nand in general, should behave as expected by web developers."),"\n",l.createElement(t.h3,{id:"scenarios-to-consider",style:{position:"relative"}},l.createElement(t.a,{href:"#scenarios-to-consider","aria-label":"scenarios to consider permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Scenarios to consider"),"\n",l.createElement(t.h4,{id:"1-trusted-url-loaded-into-a-popup-window",style:{position:"relative"}},l.createElement(t.a,{href:"#1-trusted-url-loaded-into-a-popup-window","aria-label":"1 trusted url loaded into a popup window permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"1. Trusted URL loaded into a popup window"),"\n",l.createElement(t.p,null,"In this scenario, the web view wants to create a second window, with the same APIs accessible as for the parent window.\nThe new window is treated as a new instance of the same module."),"\n",l.createElement(t.p,null,"The new window might navigate away to another URL that is not trusted, and after navigation should\nnot be able to interact with restricted APIs, even if at some point it navigates back to a trusted URL."),"\n",l.createElement(t.h4,{id:"2-trusted-url-loaded-into-an-iframe",style:{position:"relative"}},l.createElement(t.a,{href:"#2-trusted-url-loaded-into-an-iframe","aria-label":"2 trusted url loaded into an iframe permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"2. Trusted URL loaded into an iframe"),"\n",l.createElement(t.p,null,"Similarly to scenario 1, the iframe is a new instance of the same module, and has access to the same protected APIs."),"\n",l.createElement(t.p,null,"The frame might navigate away to another URL that is not trusted, and after navigation should\nnot be able to interact with restricted APIs, even if at some point it navigates back to a trusted URL."),"\n",l.createElement(t.h4,{id:"3-external-url-loaded-into-a-popup-window",style:{position:"relative"}},l.createElement(t.a,{href:"#3-external-url-loaded-into-a-popup-window","aria-label":"3 external url loaded into a popup window permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"3. External URL loaded into a popup window"),"\n",l.createElement(t.p,null,"In this scenario, the popup window should behave like a vanilla browser window, without access to protected APIs."),"\n",l.createElement(t.h4,{id:"4-external-url-loaded-into-an-iframe",style:{position:"relative"}},l.createElement(t.a,{href:"#4-external-url-loaded-into-an-iframe","aria-label":"4 external url loaded into an iframe permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"4. External URL loaded into an iframe"),"\n",l.createElement(t.p,null,"Similarly to scenario 3, the iframe should not be able to interact with protected APIs."),"\n",l.createElement(t.h4,{id:"5-iframe-as-a-layout-element",style:{position:"relative"}},l.createElement(t.a,{href:"#5-iframe-as-a-layout-element","aria-label":"5 iframe as a layout element permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"5. iframe as a layout element"),"\n",l.createElement(t.p,null,"The iframe is part of the page, scripts running in its context should be able to access protected APIs as if they\nwere running in the parent window, eg. the parent window should not receive broadcasts from the iframe.\nIf the iframe navigates to an untrusted URL, it should not be able to interact with protected APIs,\neven if it navigates back to a trusted URL."),"\n",l.createElement(t.h3,{id:"behavior-in-other-containers",style:{position:"relative"}},l.createElement(t.a,{href:"#behavior-in-other-containers","aria-label":"behavior in other containers permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Behavior in other containers"),"\n",l.createElement(t.h4,{id:"electron",style:{position:"relative"}},l.createElement(t.a,{href:"#electron","aria-label":"electron permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Electron"),"\n",l.createElement(t.p,null,"Electron provides the ",l.createElement(t.a,{href:"https://www.electronjs.org/docs/latest/api/browser-window"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">BrowserWindow</code>'}}))," API for dynamically creating and interacting with web windows.\nA single preload script can be specified for each window via the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">preload</code>'}})," property of the options objects. Preload scripts can also be customized\nfor windows created via ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">window.open</code>'}}),", see https://www.electronjs.org/docs/latest/api/window-open"),"\n",l.createElement(t.p,null,"Regarding our scenarios, Electron does not automatically preload any scripts or provide access to protected APIs (eg. via node integration) for\nwindows created in the renderer process without additional parameters."),"\n",l.createElement(t.h2,{id:"decision",style:{position:"relative"}},l.createElement(t.a,{href:"#decision","aria-label":"decision permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Decision"),"\n",l.createElement(t.p,null,"Windows opened via window.open() or a similar mechanism are considered “popup windows”. These are non-persistent and non-dockable. They are owned by the module that opened them and they are closed if the module is closed."),"\n",l.createElement(t.p,null,"To minimize risks associated with untrusted content popup windows and iframes will not inherit the parent window’s module identity or injected scripts. The same applies if the module tries to navigate to another domain.\nIf a new window needs access to these features it has to be opened as a separate module using container APIs (eg. FDC3 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">raiseIntent</code>'}})," or ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">open</code>'}}),", or the Module Loader ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">start</code>'}})," API)."),"\n",l.createElement(t.p,null,"Depending on user feedback we may design way(s) for limited communication between a module main window and its child windows and iframes. This would still not grant direct access to the container but developers could have more flexibility in these kinds of interactions. We still need to consider access control to these features (e.g. allow-listing origins in the module manifest)."),"\n",l.createElement(t.h2,{id:"consequences",style:{position:"relative"}},l.createElement(t.a,{href:"#consequences","aria-label":"consequences permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Consequences"),"\n",l.createElement(t.p,null,"Safety concerns related to loading potentially hostile arbitrary urls with access to the container api are covered.\nModules that expect to open windows or make use of iframes that access the container features will not work with the container.\nEven if we add communication options in the future we cannot ensure these features will be container agnostic."))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.RP)(),e.components);return t?l.createElement(t,e,l.createElement(r,e)):r(e)},i=n(5927),s=n(2870),c=n(9878);const d=e=>{var t,n;let{children:a,data:r,pageContext:o,location:s}=e;const d=r.allMdx.nodes.filter(e=>!e.internal.contentFilePath.includes("index")),h=r.mdx.tableOfContents.items,m=o.frontmatter.title,u=o.frontmatter.id,p=o.frontmatter.status,w=o.frontmatter.scope,f=o.frontmatter.deciders,v=new Intl.DateTimeFormat("en-US").format(new Date(o.frontmatter.date)),g=null===(t=r.site)||void 0===t||null===(n=t.siteMetadata)||void 0===n?void 0:n.title;return l.createElement(i.A,{data:r,location:s,menu:o.menu},l.createElement("article",{className:"page-main content"},l.createElement("h3",null,g)),l.createElement("article",{className:"page-main content documentation-main"},l.createElement("nav",{className:"nav documentation-nav"},l.createElement("h4",null,"Architecture"),l.createElement(c.w,{nodes:d,toc:h,location:s})),l.createElement("div",{className:"documentation-content"},l.createElement("header",null,l.createElement("h2",null,m)),l.createElement("dl",null,l.createElement("dt",null,"ADR ID"),l.createElement("dd",null,u),l.createElement("dt",null,"Status"),l.createElement("dd",null,p),l.createElement("dt",null,"Scope"),l.createElement("dd",null,w),l.createElement("dt",null,"Deciders"),l.createElement("dd",null,f),l.createElement("dt",null,"Date"),l.createElement("dd",null,v)),a)))};function h(e){return l.createElement(d,e,l.createElement(o,e))}const m=e=>{let{data:t,pageContext:n}=e;const a=n.frontmatter.title+" | "+t.site.siteMetadata.title;return l.createElement(s.A,{title:a},l.createElement("meta",{name:"description",content:n.description}))}},9878:function(e,t,n){n.d(t,{w:function(){return r}});var a=n(6540),l=n(4794);const r=e=>{let{nodes:t,toc:n,location:r}=e;return a.createElement("ul",null,t.map((e,t)=>{const o=r.pathname.includes(e.fields.slug),i=e.frontmatter.title;return a.createElement("li",{key:t,className:o?"current":""},a.createElement(l.Link,{to:e.fields.slug},i),o&&a.createElement("nav",{className:"nav documentation-content-nav"},a.createElement("ul",null,n&&n.map((e,t)=>a.createElement("li",{key:"link-"+t},a.createElement(l.Link,{to:e.url},e.title))))))}))}}}]);
//# sourceMappingURL=component---node-modules-morganstanley-gatsby-theme-ms-gh-pages-src-templates-architecture-js-content-file-path-content-architecture-adr-013-script-preloading-security-mdx-014b70e809c96535981d.js.map