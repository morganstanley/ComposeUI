"use strict";(self.webpackChunk_morgan_stanley_ComposeUI_gh_pages=self.webpackChunk_morgan_stanley_ComposeUI_gh_pages||[]).push([[135],{1946:function(e,t,n){n.r(t),n.d(t,{Head:function(){return u},default:function(){return m}});var a=n(8453),l=n(6540);function s(e){const t=Object.assign({h2:"h2",a:"a",span:"span",p:"p",h3:"h3",h4:"h4"},(0,a.RP)(),e.components);return l.createElement(l.Fragment,null,"\n",l.createElement(t.h2,{id:"context",style:{position:"relative"}},l.createElement(t.a,{href:"#context","aria-label":"context permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Context"),"\n",l.createElement(t.p,null,"Module Loader is responsible for starting and stopping module instances. It is also responsible for emitting lifetime events of module instances, such as ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Starting</code>'}}),", ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Started</code>'}}),", ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Stopping</code>'}}),", ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Stopped</code>'}}),"."),"\n",l.createElement(t.p,null,"The current architecture is built on top of ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObservable&lt;T></code>'}}),":"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="c#"><pre class="language-c#"><code class="language-c#">public interface IModuleLoader\n{\n    IObservable&lt;LifetimeEvent&gt; LifetimeEvents { get; }\n\n    // other members omitted for brevity\n}</code></pre></div>'}}),"\n",l.createElement(t.h3,{id:"current-usages",style:{position:"relative"}},l.createElement(t.a,{href:"#current-usages","aria-label":"current usages permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Current usages"),"\n",l.createElement(t.h4,{id:"raising-events",style:{position:"relative"}},l.createElement(t.a,{href:"#raising-events","aria-label":"raising events permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Raising events"),"\n",l.createElement(t.p,null,"The Module Loader is responsible for raising lifetime events. This is currently achieved by using a ",l.createElement(t.a,{href:"https://learn.microsoft.com/en-us/previous-versions/dotnet/reactive-extensions/hh229173(v=vs.103)"},"Subject"),". Subjects implement both ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObservable&lt;T></code>'}})," and ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObserver&lt;T></code>'}}),", and when a lifetime event needs to be emitted we call ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">OnNext()</code>'}})," on the subject."),"\n",l.createElement(t.h4,{id:"consuming-events",style:{position:"relative"}},l.createElement(t.a,{href:"#consuming-events","aria-label":"consuming events permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Consuming events"),"\n",l.createElement(t.p,null,"Module Loader lifetime events are consumed by ComposeUI infrastructure code, but can also be consumed by external applications."),"\n",l.createElement(t.p,null,"Current infrastructure usages utilize ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">System.Reactive</code>'}})," extensions and its ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">LINQ</code>'}})," operators. For example:"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="c#"><pre class="language-c#"><code class="language-c#">internal sealed class ModuleService : IHostedService\n{\n    // ...\n    public Task StartAsync(CancellationToken cancellationToken)\n    {\n        _disposables.Add(\n            _moduleLoader.LifetimeEvents\n                .OfType&lt;LifetimeEvent.Started&gt;()\n                .Where(e =&gt; e.Instance.Manifest.ModuleType == ModuleType.Web)\n                .Subscribe(OnWebModuleStarted));</code></pre></div>'}}),"\n",l.createElement(t.p,null,"This usage filters lifetime events by type and by content to subscribe only to the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Started</code>'}})," events of ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Web</code>'}})," module instances."),"\n",l.createElement(t.p,null,"Another usage uses the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">ObserveOn()</code>'}})," extension method which ensures that the observer’s ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">OnNext()</code>'}})," method is invoked via the specified scheduler, in this case using the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">DispatcherSynchronizationContext</code>'}})," from WPF."),"\n",l.createElement(t.p,null,"In our FDC3 Desktop Agent implementation we use ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">System.Reactive.Async</code>'}})," to convert the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObservable&lt;T></code>'}})," events to ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IAsyncObservable&lt;T></code>'}})," so that the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">OnNext()</code>'}})," calls are properly awaited:"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="c#"><pre class="language-c#"><code class="language-c#">        var observable = _moduleLoader.LifetimeEvents.ToAsyncObservable();\n        var subscription = await observable.SubscribeAsync(async lifetimeEvent =&gt;\n        {\n            // code containing await</code></pre></div>'}}),"\n",l.createElement(t.h2,{id:"alternatives-considered",style:{position:"relative"}},l.createElement(t.a,{href:"#alternatives-considered","aria-label":"alternatives considered permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Alternatives considered"),"\n",l.createElement(t.h3,{id:"events",style:{position:"relative"}},l.createElement(t.a,{href:"#events","aria-label":"events permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Events"),"\n",l.createElement(t.p,null,"The most obvious alternative to ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObservable&lt;T></code>'}})," is the built-in ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">event</code>'}})," feature in C# / .NET. Raising lifetime events would be very similar to the current code, however subscribing to these events would be limited to the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">+=</code>'}})," operator. Since we’re already relying on the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">LINQ</code>'}})," operators provided by Rx.NET using built-in ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">events</code>'}})," instead would be inferior."),"\n",l.createElement(t.p,null,"The current implementation of the FDC3 Desktop Agent relies on awaiting in the ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">OnNextAsync()</code>'}})," handler. Implementing the same behavior by using built-in ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">events</code>'}})," would be challenging (if possible at all)."),"\n",l.createElement(t.h3,{id:"iasyncobservablet",style:{position:"relative"}},l.createElement(t.a,{href:"#iasyncobservablet","aria-label":"iasyncobservablet permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IAsyncObservable&lt;T></code>'}})),"\n",l.createElement(t.p,null,l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IAsyncObservable&lt;T></code>'}})," is part of ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">System.Reactive.Async</code>'}})," package, for which the latest available version as of today is 6.0.0-alpha.18, which is a pre-release version."),"\n",l.createElement(t.p,null,"We are already using this package internally but we don’t want to enforce pre-release dependencies on our customers by changing the public interface to use ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IAsyncObservable&lt;T></code>'}}),"."),"\n",l.createElement(t.h2,{id:"decision",style:{position:"relative"}},l.createElement(t.a,{href:"#decision","aria-label":"decision permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Decision"),"\n",l.createElement(t.p,null,"We continue using ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">IObservable&lt;T></code>'}})," for Module Loader lifetime events."),"\n",l.createElement(t.h2,{id:"consequences",style:{position:"relative"}},l.createElement(t.a,{href:"#consequences","aria-label":"consequences permalink",className:"anchor before"},l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Consequences"),"\n",l.createElement(t.p,null,"We will revisit this ADR once there will be a stable version of ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">System.Reactive.Async</code>'}})," package available."))}var r=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.RP)(),e.components);return t?l.createElement(t,e,l.createElement(s,e)):s(e)},c=n(5927),o=n(2870),i=n(9878);const d=e=>{var t,n;let{children:a,data:s,pageContext:r,location:o}=e;const d=s.allMdx.nodes.filter(e=>!e.internal.contentFilePath.includes("index")),m=s.mdx.tableOfContents.items,u=r.frontmatter.title,h=r.frontmatter.id,g=r.frontmatter.status,v=r.frontmatter.scope,p=r.frontmatter.deciders,b=new Intl.DateTimeFormat("en-US").format(new Date(r.frontmatter.date)),E=null===(t=s.site)||void 0===t||null===(n=t.siteMetadata)||void 0===n?void 0:n.title;return l.createElement(c.A,{data:s,location:o,menu:r.menu},l.createElement("article",{className:"page-main content"},l.createElement("h3",null,E)),l.createElement("article",{className:"page-main content documentation-main"},l.createElement("nav",{className:"nav documentation-nav"},l.createElement("h4",null,"Architecture"),l.createElement(i.w,{nodes:d,toc:m,location:o})),l.createElement("div",{className:"documentation-content"},l.createElement("header",null,l.createElement("h2",null,u)),l.createElement("dl",null,l.createElement("dt",null,"ADR ID"),l.createElement("dd",null,h),l.createElement("dt",null,"Status"),l.createElement("dd",null,g),l.createElement("dt",null,"Scope"),l.createElement("dd",null,v),l.createElement("dt",null,"Deciders"),l.createElement("dd",null,p),l.createElement("dt",null,"Date"),l.createElement("dd",null,b)),a)))};function m(e){return l.createElement(d,e,l.createElement(r,e))}const u=e=>{let{data:t,pageContext:n}=e;const a=n.frontmatter.title+" | "+t.site.siteMetadata.title;return l.createElement(o.A,{title:a},l.createElement("meta",{name:"description",content:n.description}))}},9878:function(e,t,n){n.d(t,{w:function(){return s}});var a=n(6540),l=n(4794);const s=e=>{let{nodes:t,toc:n,location:s}=e;return a.createElement("ul",null,t.map((e,t)=>{const r=s.pathname.includes(e.fields.slug),c=e.frontmatter.title;return a.createElement("li",{key:t,className:r?"current":""},a.createElement(l.Link,{to:e.fields.slug},c),r&&a.createElement("nav",{className:"nav documentation-content-nav"},a.createElement("ul",null,n&&n.map((e,t)=>a.createElement("li",{key:"link-"+t},a.createElement(l.Link,{to:e.url},e.title))))))}))}}}]);
//# sourceMappingURL=component---node-modules-morganstanley-gatsby-theme-ms-gh-pages-src-templates-architecture-js-content-file-path-content-architecture-adr-015-module-loader-events-mdx-0bb2c37de77b92918bd4.js.map